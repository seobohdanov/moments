<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Photo Order App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Order Photo Prints</h1>
        <div id="content"></div>
        <div id="navigation">
            <button id="prev-step" class="btn btn-secondary" style="display: none;">Previous</button>
            <button id="next-step" class="btn btn-primary">Next</button>
        </div>
    </div>
    <script>
        let currentStep = 0;

        const steps = [
            { url: "{{ url_for('index_partial') }}", method: "GET" },
            { url: "{{ url_for('order_summary_partial') }}", method: "GET" },
            { url: "{{ url_for('complete_order_form_partial') }}", method: "GET" },
            { url: "{{ url_for('confirmation_partial') }}", method: "GET" }
        ];

        function loadStep(stepIndex) {
            if (stepIndex >= 0 && stepIndex < steps.length) {
                $.ajax({
                    url: steps[stepIndex].url,
                    method: steps[stepIndex].method,
                    success: function (data) {
                        $('#content').html(data);
                        currentStep = stepIndex;
                        updateNavigation();
                    },
                    error: function (error) {
                        console.error('Error loading step:', error);
                    }
                });
            }
        }

        function updateNavigation() {
            $('#prev-step').toggle(currentStep > 0);
            $('#next-step').toggle(currentStep < steps.length - 1);
        }

        $(document).ready(function () {
            loadStep(0); // Load the first step

            $('#prev-step').click(function () {
                loadStep(currentStep - 1);
            });

            $('#next-step').click(function () {
                if (currentStep === steps.length - 2) {
                    // Handle form submission on the second last step
                    const formData = new FormData($('#orderForm')[0]);
                    $.ajax({
                        url: steps[currentStep].url,
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (data) {
                            loadStep(currentStep + 1);
                        },
                        error: function (error) {
                            console.error('Error submitting form:', error);
                        }
                    });
                } else {
                    loadStep(currentStep + 1);
                }
            });
        });
    </script>
</body>
</html>